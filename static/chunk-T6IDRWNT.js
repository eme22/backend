import{a as z,b as J}from"./chunk-LTQIWH4L.js";import{b as R,d as W,e as L,f as A,g as O,h as U,m as G,n as H,o as V,q,s as B}from"./chunk-3BSRKISZ.js";import{Cb as D,Fc as k,Ga as M,Gb as d,Ia as l,Ib as u,Ic as x,Kb as C,Lb as b,Mb as v,Oa as f,Va as I,Xb as T,Za as s,a as w,aa as E,b as S,ba as F,ia as h,lb as g,mb as o,nb as i,ob as _,rc as N,sc as P,wb as p,xb as c,xc as j}from"./chunk-7IT3E43U.js";function Q(r,n){if(r&1&&_(0,"img",23),r&2){let t=c(2);g("src",t.imagePreview,M)}}function X(r,n){if(r&1&&_(0,"img",25),r&2){let t=c(3);g("src",t.categoryForm.image_url,M)}}function Y(r,n){if(r&1&&s(0,X,1,1,"img",24),r&2){let t=c(2);g("ngIf",t.categoryForm.image_url)}}function Z(r,n){if(r&1&&(o(0,"div",21),s(1,Q,1,1,"img",22)(2,Y,1,1,"ng-template",null,0,T),i()),r&2){let t=D(3),e=c();l(),g("ngIf",e.imagePreview)("ngIfElse",t)}}function $(r,n){if(r&1&&(o(0,"option",26),d(1),i()),r&2){let t=n.$implicit,e=c();g("value",t.category_id)("disabled",e.data.mode==="edit"&&(e.data.category==null?null:e.data.category.category_id)===t.category_id),l(),u(" ",t.name," ")}}function ee(r,n){if(r&1&&(o(0,"div",27),d(1),i()),r&2){let t=c();l(),u(" ",t.error()," ")}}var K=class r{constructor(n,t,e){this.dialogRef=n;this.data=t;this.http=e;t.mode==="edit"&&t.category&&(this.categoryForm={name:t.category.name,description:t.category.description||"",parent_category_id:t.category.parent_category_id||null,image_url:t.category.image_url||""})}loading=h(!1);error=h(null);categoryForm={name:"",description:"",parent_category_id:null,image_url:""};imagePreview=null;onFileSelected(n){let t=n.target;if(!t.files||t.files.length===0)return;let e=t.files[0],m=new FileReader;m.onload=y=>{this.imagePreview=y.target.result},m.readAsDataURL(e);let a=new FormData;a.append("file",e),this.loading.set(!0),this.http.post(`${x.apiUrl}/upload`,a).subscribe({next:y=>{this.categoryForm.image_url=y.url,this.loading.set(!1)},error:y=>{this.loading.set(!1),this.error.set("Error al subir la imagen")}})}closeModal(){this.dialogRef.close()}saveCategory(){this.loading.set(!0),this.error.set(null);let n=S(w({},this.categoryForm),{parent_category_id:this.categoryForm.parent_category_id||null,image_url:this.categoryForm.image_url||""});(this.data.mode==="create"?this.http.post(`${x.apiUrl}/categories`,n):this.http.put(`${x.apiUrl}/categories/${this.data.category.category_id}`,n)).subscribe({next:e=>{this.loading.set(!1),this.dialogRef.close(e)},error:e=>{this.loading.set(!1),this.error.set(e.error?.message||"Error al guardar categor\xEDa"),console.error("Error saving category:",e)}})}static \u0275fac=function(t){return new(t||r)(f(z),f(J),f(k))};static \u0275cmp=I({type:r,selectors:[["app-category-modal"]],decls:35,vars:9,consts:[["urlPreview",""],[1,"bg-white","rounded-lg","shadow-xl","max-w-md","w-full","mx-4"],[1,"flex","justify-between","items-center","p-6","border-b"],[1,"text-xl","font-bold","text-gray-900"],[1,"text-gray-400","hover:text-gray-600","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],["enctype","multipart/form-data",1,"p-6","space-y-4",3,"ngSubmit"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"flex","items-center","space-x-4"],["class","w-20 h-20 rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center border",4,"ngIf"],["type","file","accept","image/*",1,"block","w-full","text-sm","text-gray-500","file:mr-4","file:py-2","file:px-4","file:rounded-lg","file:border-0","file:text-sm","file:font-semibold","file:bg-primary-50","file:text-primary-700","hover:file:bg-primary-100",3,"change"],["type","text","name","name","required","","placeholder","Ingrese nombre de la categor\xEDa",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-primary-500","focus:border-transparent",3,"ngModelChange","ngModel"],["name","description","rows","3","placeholder","Ingrese descripci\xF3n (opcional)",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-primary-500","focus:border-transparent",3,"ngModelChange","ngModel"],["name","parent_category_id",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-primary-500","focus:border-transparent",3,"ngModelChange","ngModel"],["value",""],[3,"value","disabled",4,"ngFor","ngForOf"],["class","text-red-600 text-sm",4,"ngIf"],[1,"flex","justify-end","space-x-3","pt-4"],["type","button",1,"px-4","py-2","text-sm","font-medium","text-gray-700","bg-gray-100","hover:bg-gray-200","rounded-md","transition-colors",3,"click"],["type","submit",1,"px-4","py-2","text-sm","font-medium","text-white","bg-primary-600","hover:bg-primary-700","rounded-md","transition-colors","disabled:opacity-50",3,"disabled"],[1,"w-20","h-20","rounded-lg","overflow-hidden","bg-gray-100","flex","items-center","justify-center","border"],["alt","Preview","class","object-cover w-full h-full",3,"src",4,"ngIf","ngIfElse"],["alt","Preview",1,"object-cover","w-full","h-full",3,"src"],["alt","Imagen actual","class","object-cover w-full h-full",3,"src",4,"ngIf"],["alt","Imagen actual",1,"object-cover","w-full","h-full",3,"src"],[3,"value","disabled"],[1,"text-red-600","text-sm"]],template:function(t,e){t&1&&(o(0,"div",1)(1,"div",2)(2,"h2",3),d(3),i(),o(4,"button",4),p("click",function(){return e.closeModal()}),E(),o(5,"svg",5),_(6,"path",6),i()()(),F(),o(7,"form",7),p("ngSubmit",function(){return e.saveCategory()}),o(8,"div")(9,"label",8),d(10,"Imagen"),i(),o(11,"div",9),s(12,Z,4,2,"div",10),o(13,"input",11),p("change",function(a){return e.onFileSelected(a)}),i()()(),o(14,"div")(15,"label",8),d(16,"Nombre"),i(),o(17,"input",12),v("ngModelChange",function(a){return b(e.categoryForm.name,a)||(e.categoryForm.name=a),a}),i()(),o(18,"div")(19,"label",8),d(20,"Descripci\xF3n"),i(),o(21,"textarea",13),v("ngModelChange",function(a){return b(e.categoryForm.description,a)||(e.categoryForm.description=a),a}),i()(),o(22,"div")(23,"label",8),d(24,"Categor\xEDa Padre"),i(),o(25,"select",14),v("ngModelChange",function(a){return b(e.categoryForm.parent_category_id,a)||(e.categoryForm.parent_category_id=a),a}),o(26,"option",15),d(27,"Categor\xEDa ra\xEDz"),i(),s(28,$,2,3,"option",16),i()(),s(29,ee,2,1,"div",17),o(30,"div",18)(31,"button",19),p("click",function(){return e.closeModal()}),d(32," Cancelar "),i(),o(33,"button",20),d(34),i()()()()),t&2&&(l(3),u(" ",e.data.mode==="create"?"Crear Categor\xEDa":"Editar Categor\xEDa"," "),l(9),g("ngIf",e.imagePreview||e.categoryForm.image_url),l(5),C("ngModel",e.categoryForm.name),l(4),C("ngModel",e.categoryForm.description),l(4),C("ngModel",e.categoryForm.parent_category_id),l(3),g("ngForOf",e.data.categories),l(),g("ngIf",e.error()),l(4),g("disabled",e.loading()),l(),u(" ",e.loading()?"Guardando...":e.data.mode==="create"?"Crear":"Guardar"," "))},dependencies:[j,N,P,B,U,H,V,R,G,W,L,q,O,A],encapsulation:2})};export{K as a};
