import{a as I}from"./chunk-VFZDXDUG.js";import{a as Z}from"./chunk-7J25FSRY.js";import{c as Y}from"./chunk-LTQIWH4L.js";import{h as U}from"./chunk-HYBTYU64.js";import{b as H,d as z,g as G,m as J,n as K,o as Q,s as X}from"./chunk-3BSRKISZ.js";import"./chunk-TYBCTD6A.js";import{$ as x,Cb as V,Eb as w,Fc as B,Ga as k,Gb as n,Hb as E,Ia as a,Ib as p,Ic as h,Jb as j,Kb as P,Lb as C,Mb as b,Oa as v,Tb as F,Va as A,Vb as W,Xb as q,Za as g,_,aa as T,ba as M,ia as f,lb as m,mb as r,nb as i,ob as y,rc as L,sb as D,sc as O,tb as N,ub as S,wb as u,wc as $,xb as l,xc as R}from"./chunk-7IT3E43U.js";function te(s,t){if(s&1&&(r(0,"option",22),n(1),i()),s&2){let e=t.$implicit;m("value",e.category_id),a(),p(" ",e.name," ")}}function ie(s,t){if(s&1&&(D(0),y(1,"img",36),N()),s&2){let e=l().$implicit,o=l();a(),m("src",o.getPrincipalImage(e),k)("alt",e.name)}}function re(s,t){if(s&1&&(r(0,"span",37),n(1),i()),s&2){let e=l().$implicit;a(),E(e.name.charAt(0).toUpperCase())}}function oe(s,t){if(s&1){let e=S();r(0,"tr")(1,"td",23)(2,"div",24)(3,"div",25),g(4,ie,2,2,"ng-container",26)(5,re,2,1,"ng-template",null,0,q),i(),r(7,"div",27)(8,"div",28),n(9),i(),r(10,"div",29),n(11),F(12,"slice"),i()()()(),r(13,"td",30),n(14),i(),r(15,"td",30),n(16),i(),r(17,"td",30)(18,"span",31),n(19),i()(),r(20,"td",23)(21,"span",31),n(22),i()(),r(23,"td",32)(24,"button",33),u("click",function(){let c=_(e).$implicit,d=l();return x(d.editProduct(c))}),n(25," Editar "),i(),r(26,"button",34),u("click",function(){let c=_(e).$implicit,d=l();return x(d.toggleProductStatus(c))}),n(27),i(),r(28,"button",35),u("click",function(){let c=_(e).$implicit,d=l();return x(d.deleteProduct(c))}),n(29," Eliminar "),i()()()}if(s&2){let e=t.$implicit,o=V(6),c=l();a(4),m("ngIf",c.getPrincipalImage(e))("ngIfElse",o),a(5),E(e.name),a(2),j("",W(12,30,e.description,0,50),"",e.description&&e.description.length>50?"...":""),a(3),p(" ",(e.category==null?null:e.category.name)||"Sin categor\xEDa"," "),a(2),p(" $",e.price.toLocaleString()," "),a(2),w("bg-green-100",e.stock_quantity>10)("text-green-800",e.stock_quantity>10)("bg-yellow-100",e.stock_quantity>0&&e.stock_quantity<=10)("text-yellow-800",e.stock_quantity>0&&e.stock_quantity<=10)("bg-red-100",e.stock_quantity===0)("text-red-800",e.stock_quantity===0),a(),p(" ",e.stock_quantity," "),a(2),w("bg-green-100",e.is_active)("text-green-800",e.is_active)("bg-red-100",!e.is_active)("text-red-800",!e.is_active),a(),p(" ",e.is_active?"Activo":"Inactivo"," "),a(5),p(" ",e.is_active?"Desactivar":"Activar"," ")}}function ne(s,t){if(s&1){let e=S();r(0,"button",4),u("click",function(){_(e);let c=l(2);return x(c.openCreateModal())}),n(1," Crear Primer Producto "),i()}}function ae(s,t){if(s&1&&(r(0,"div",38)(1,"div",39),T(),r(2,"svg",40),y(3,"path",41),i()(),M(),r(4,"h3",42),n(5),i(),r(6,"p",43),n(7),i(),g(8,ne,2,0,"button",44),i()),s&2){let e=l();a(5),p(" ",e.searchTerm||e.selectedCategory||e.selectedStatus?"No se encontraron productos":"No hay productos"," "),a(2),p(" ",e.searchTerm||e.selectedCategory||e.selectedStatus?"Intenta con otros filtros de b\xFAsqueda":"Comienza agregando tu primer producto"," "),a(),m("ngIf",!e.searchTerm&&!e.selectedCategory&&!e.selectedStatus)}}function se(s,t){s&1&&(r(0,"div",45),y(1,"div",46),i())}var ee=class s{constructor(t,e,o,c){this.http=t;this.dialog=e;this.toastrService=o;this.confirmationService=c}products=f([]);filteredProducts=f([]);categories=f([]);loading=f(!1);error=f(null);searchTerm="";selectedCategory="";selectedStatus="";ngOnInit(){this.loadProducts(),this.loadCategories()}getPrincipalImage(t){return t.images?.find(e=>e.is_primary)?.image_url||null}openCreateModal(){this.dialog.open(I,{data:{mode:"create",categories:this.categories()},width:"600px",maxWidth:"90vw"}).closed.subscribe(e=>{e&&(this.toastrService.success("Producto creado exitosamente","\xC9xito"),this.loadProducts())})}editProduct(t){this.dialog.open(I,{data:{product:t,mode:"edit",categories:this.categories()},width:"600px",maxWidth:"90vw"}).closed.subscribe(o=>{o&&(this.toastrService.success("Producto actualizado exitosamente","\xC9xito"),this.loadProducts())})}loadProducts(){this.loading.set(!0),this.http.get(`${h.apiUrl}/products`).subscribe({next:t=>{this.products.set(t.products),this.filteredProducts.set(t.products),this.loading.set(!1)},error:t=>{this.error.set("Error loading products"),this.loading.set(!1),this.toastrService.error("Error al cargar productos","Error"),console.error("Error loading products:",t)}})}loadCategories(){this.http.get(`${h.apiUrl}/categories`).subscribe({next:t=>{this.categories.set(t)},error:t=>{console.error("Error loading categories:",t)}})}filterProducts(){let t=this.products();if(this.searchTerm&&(t=t.filter(e=>e.name.toLowerCase().includes(this.searchTerm.toLowerCase())||e.description&&e.description.toLowerCase().includes(this.searchTerm.toLowerCase()))),this.selectedCategory&&(t=t.filter(e=>e.category_id.toString()===this.selectedCategory)),this.selectedStatus){let e=this.selectedStatus==="active";t=t.filter(o=>o.is_active===e)}this.filteredProducts.set(t)}toggleProductStatus(t){this.http.patch(`${h.apiUrl}/products/${t.product_id}/status`,{is_active:!t.is_active}).subscribe({next:()=>{t.is_active=!t.is_active,this.filteredProducts.set([...this.filteredProducts()]),this.toastrService.success(`Producto ${t.is_active?"activado":"desactivado"} exitosamente`,"\xC9xito")},error:e=>{this.toastrService.error("Error al cambiar el estado del producto","Error"),console.error("Error updating product status:",e)}})}deleteProduct(t){this.confirmationService.confirm({title:"Eliminar Producto",message:`\xBFEst\xE1 seguro de eliminar el producto "${t.name}"?`,type:"danger"}).subscribe(e=>{e&&this.http.delete(`${h.apiUrl}/products/${t.product_id}`).subscribe({next:()=>{this.toastrService.success("Producto eliminado exitosamente","\xC9xito"),this.loadProducts()},error:o=>{this.toastrService.error("Error al eliminar producto","Error"),console.error("Error deleting product:",o)}})})}static \u0275fac=function(e){return new(e||s)(v(B),v(Y),v(U),v(Z))};static \u0275cmp=A({type:s,selectors:[["app-admin-products"]],decls:41,vars:7,consts:[["productInitial",""],[1,"p-6"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"bg-primary-600","text-white","px-4","py-2","rounded-lg","hover:bg-primary-700","transition-colors",3,"click"],[1,"bg-white","p-4","rounded-lg","shadow","mb-6"],[1,"flex","flex-wrap","gap-4"],["type","text","placeholder","Buscar productos...",1,"px-4","py-2","border","rounded-lg","focus:ring-2","focus:ring-primary-500","focus:border-transparent",3,"ngModelChange","input","ngModel"],[1,"px-4","py-2","border","rounded-lg","focus:ring-2","focus:ring-primary-500","focus:border-transparent",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["value","active"],["value","inactive"],[1,"bg-white","rounded-lg","shadow","overflow-hidden"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-50"],[1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"bg-white","divide-y","divide-gray-200"],[4,"ngFor","ngForOf"],["class","text-center py-12",4,"ngIf"],["class","flex justify-center py-8",4,"ngIf"],[3,"value"],[1,"px-6","py-4","whitespace-nowrap"],[1,"flex","items-center"],[1,"w-12","h-12","rounded-lg","flex","items-center","justify-center","bg-gray-100","overflow-hidden","border"],[4,"ngIf","ngIfElse"],[1,"ml-4"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-sm","text-gray-500"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-gray-900"],[1,"px-2","py-1","text-xs","font-medium","rounded-full"],[1,"px-6","py-4","whitespace-nowrap","text-sm","font-medium"],[1,"text-primary-600","hover:text-primary-900","mr-3",3,"click"],[1,"text-yellow-600","hover:text-yellow-900","mr-3",3,"click"],[1,"text-red-600","hover:text-red-900",3,"click"],[1,"object-cover","w-full","h-full",3,"src","alt"],[1,"text-white","text-base","font-medium","bg-blue-500","w-full","h-full","flex","items-center","justify-center"],[1,"text-center","py-12"],[1,"mx-auto","w-24","h-24","bg-gray-100","rounded-full","flex","items-center","justify-center","mb-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"],[1,"text-lg","font-medium","text-gray-900","mb-2"],[1,"text-gray-500","mb-4"],["class","bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 transition-colors",3,"click",4,"ngIf"],[1,"flex","justify-center","py-8"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-primary-600"]],template:function(e,o){e&1&&(r(0,"div",1)(1,"div",2)(2,"h1",3),n(3,"Gesti\xF3n de Productos"),i(),r(4,"button",4),u("click",function(){return o.openCreateModal()}),n(5," Crear Producto "),i()(),r(6,"div",5)(7,"div",6)(8,"input",7),b("ngModelChange",function(d){return C(o.searchTerm,d)||(o.searchTerm=d),d}),u("input",function(){return o.filterProducts()}),i(),r(9,"select",8),b("ngModelChange",function(d){return C(o.selectedCategory,d)||(o.selectedCategory=d),d}),u("change",function(){return o.filterProducts()}),r(10,"option",9),n(11,"Todas las categor\xEDas"),i(),g(12,te,2,2,"option",10),i(),r(13,"select",8),b("ngModelChange",function(d){return C(o.selectedStatus,d)||(o.selectedStatus=d),d}),u("change",function(){return o.filterProducts()}),r(14,"option",9),n(15,"Todos los estados"),i(),r(16,"option",11),n(17,"Activo"),i(),r(18,"option",12),n(19,"Inactivo"),i()()()(),r(20,"div",13)(21,"div",14)(22,"table",15)(23,"thead",16)(24,"tr")(25,"th",17),n(26," Producto "),i(),r(27,"th",17),n(28," Categor\xEDa "),i(),r(29,"th",17),n(30," Precio "),i(),r(31,"th",17),n(32," Stock "),i(),r(33,"th",17),n(34," Estado "),i(),r(35,"th",17),n(36," Acciones "),i()()(),r(37,"tbody",18),g(38,oe,30,34,"tr",19),i()()(),g(39,ae,9,3,"div",20),i(),g(40,se,2,0,"div",21),i()),e&2&&(a(8),P("ngModel",o.searchTerm),a(),P("ngModel",o.selectedCategory),a(3),m("ngForOf",o.categories()),a(),P("ngModel",o.selectedStatus),a(25),m("ngForOf",o.filteredProducts()),a(),m("ngIf",!o.loading()&&o.filteredProducts().length===0),a(),m("ngIf",o.loading()))},dependencies:[R,L,O,X,K,Q,H,J,z,G,$],encapsulation:2})};export{ee as AdminProductsComponent};
