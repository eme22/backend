import{a as q}from"./chunk-5RPAAXS7.js";import{a as L}from"./chunk-IOE45DK7.js";import{b as z,d as G,g as H,i as U,m as J,n as K,o as Q,s as X}from"./chunk-TPTRQRQT.js";import{a as R}from"./chunk-PWJAWN2C.js";import{d as W,g as A}from"./chunk-5NKQJYQU.js";import"./chunk-KL4PSEE7.js";import{$ as x,Eb as V,Ga as T,Gb as o,Hb as h,Ia as a,Ib as u,Jb as F,Kb as y,Lb as C,Mb as w,Oa as S,Tb as M,Ub as k,Va as I,Za as _,_ as f,aa as P,ba as O,ia as g,lb as c,mb as t,nb as i,ob as b,rc as D,sc as N,ub as v,uc as j,wb as m,xb as p,xc as B}from"./chunk-HE7H4WY4.js";function Z(l,n){if(l&1&&(t(0,"option",31),o(1),i()),l&2){let e=n.$implicit;c("value",e.category_id),a(),u(" ",e.name," ")}}function $(l,n){l&1&&(t(0,"div",32),b(1,"div",33),i())}function ee(l,n){if(l&1){let e=v();t(0,"div",34)(1,"div",35),P(),t(2,"svg",36),b(3,"path",37),i()(),O(),t(4,"h3",38),o(5,"Error al cargar las ofertas"),i(),t(6,"p",39),o(7),i(),t(8,"button",40),m("click",function(){f(e);let s=p();return x(s.loadOffers())}),o(9," Intentar de nuevo "),i()()}if(l&2){let e=p();a(7),h(e.error())}}function te(l,n){if(l&1){let e=v();t(0,"div",48)(1,"div",49),o(2," \xA1OFERTA! "),i(),t(3,"div",50),b(4,"img",51),i(),t(5,"div",52)(6,"h3",53),o(7),i(),t(8,"p",54),o(9),i(),t(10,"p",55),o(11),i(),t(12,"div",6)(13,"div",56)(14,"span",57),o(15),M(16,"number"),i(),t(17,"span",58),o(18),M(19,"number"),i()(),t(20,"button",59),m("click",function(){let s=f(e).$implicit,d=p(2);return x(d.addToCart(s))}),o(21),i()(),t(22,"div",60),o(23),i()()()}if(l&2){let e=n.$implicit;a(4),c("src",(e.images==null||e.images[0]==null?null:e.images[0].image_url)||"/placeholder-product.jpg",T)("alt",e.name),a(3),h(e.name),a(2),h(e.category==null?null:e.category.name),a(2),h(e.description),a(4),u(" ","$"+k(16,10,e.price,"1.2-2")," "),a(3),u(" ","$"+k(19,13,e.price*1.2,"1.2-2")," "),a(2),c("disabled",e.stock_quantity===0),a(),u(" ",e.stock_quantity===0?"Sin Stock":"Agregar"," "),a(2),u(" Stock: ",e.stock_quantity," unidades ")}}function ie(l,n){if(l&1){let e=v();t(0,"button",65),m("click",function(){let s=f(e).$implicit,d=p(3);return x(d.goToPage(s))}),o(1),i()}if(l&2){let e=n.$implicit,r=p(3);V("bg-primary-600",e===r.currentPage())("text-white",e===r.currentPage())("text-gray-700",e!==r.currentPage()),a(),u(" ",e," ")}}function re(l,n){if(l&1){let e=v();t(0,"div",61)(1,"nav",62)(2,"button",63),m("click",function(){f(e);let s=p(2);return x(s.goToPage(s.currentPage()-1))}),o(3," Anterior "),i(),_(4,ie,2,7,"button",64),t(5,"button",63),m("click",function(){f(e);let s=p(2);return x(s.goToPage(s.currentPage()+1))}),o(6," Siguiente "),i()()()}if(l&2){let e=p(2);a(2),c("disabled",e.currentPage()===1),a(2),c("ngForOf",e.getVisiblePages()),a(),c("disabled",e.currentPage()===e.totalPages())}}function ne(l,n){if(l&1&&(t(0,"div",41)(1,"div",42)(2,"h2",43),o(3),i(),t(4,"div",44),o(5),i()(),t(6,"div",45),_(7,te,24,16,"div",46),i(),_(8,re,7,3,"div",47),i()),l&2){let e=p();a(3),u(" Productos en Oferta (",e.totalProducts(),") "),a(2),F(" P\xE1gina ",e.currentPage()," de ",e.totalPages()," "),a(2),c("ngForOf",e.products()),a(),c("ngIf",e.totalPages()>1)}}function oe(l,n){if(l&1){let e=v();t(0,"div",66)(1,"div",67),P(),t(2,"svg",68),b(3,"path",69),i()(),O(),t(4,"h3",38),o(5,"No hay ofertas disponibles"),i(),t(6,"p",70),o(7," No se encontraron productos en oferta con los filtros seleccionados. "),i(),t(8,"button",71),m("click",function(){f(e);let s=p();return x(s.clearFilters())}),o(9," Ver todas las ofertas "),i()()}}var Y=class l{constructor(n,e,r){this.productsService=n;this.categoriesService=e;this.cartService=r}products=g([]);categories=g([]);loading=g(!1);error=g(null);currentPage=g(1);totalProducts=g(0);totalPages=g(0);filters={page:1,limit:12};sortBy="name";ngOnInit(){this.loadCategories(),this.loadOffers()}loadCategories(){this.categoriesService.getAllCategories().subscribe({next:n=>{this.categories.set(n)},error:n=>{console.error("Error loading categories:",n)}})}loadOffers(){this.loading.set(!0),this.error.set(null),this.productsService.getProductsOnOffer(this.filters).subscribe({next:n=>{this.products.set(n.products),this.totalProducts.set(n.total),this.currentPage.set(n.page),this.totalPages.set(Math.ceil(n.total/n.limit)),this.sortProducts(),this.loading.set(!1)},error:n=>{console.error("Error loading offers:",n),this.error.set("No se pudieron cargar las ofertas"),this.loading.set(!1)}})}onFilterChange(){this.filters.page=1,this.loadOffers()}onSortChange(){this.sortProducts()}sortProducts(){let n=[...this.products()];switch(this.sortBy){case"name":n.sort((e,r)=>e.name.localeCompare(r.name));break;case"price_asc":n.sort((e,r)=>e.price-r.price);break;case"price_desc":n.sort((e,r)=>r.price-e.price);break;case"newest":n.sort((e,r)=>new Date(r.created_at).getTime()-new Date(e.created_at).getTime());break}this.products.set(n)}clearFilters(){this.filters={page:1,limit:12},this.sortBy="name",this.loadOffers()}goToPage(n){n>=1&&n<=this.totalPages()&&(this.filters.page=n,this.loadOffers())}getVisiblePages(){let n=this.currentPage(),e=this.totalPages(),r=[],s=Math.max(1,n-2),d=Math.min(e,n+2);for(let E=s;E<=d;E++)r.push(E);return r}addToCart(n){n.stock_quantity!==0&&this.cartService.addToCart({product_id:n.product_id,quantity:1}).subscribe({next:e=>{console.log("Product added to cart:",e)},error:e=>{console.error("Error adding product to cart:",e)}})}static \u0275fac=function(e){return new(e||l)(S(q),S(L),S(R))};static \u0275cmp=I({type:l,selectors:[["app-offers"]],decls:59,vars:9,consts:[[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-8"],[1,"mb-8"],[1,"flex","items-center","space-x-2","text-sm","text-gray-500","mb-4"],["routerLink","/",1,"hover:text-primary-600"],[1,"text-gray-900"],[1,"bg-gradient-to-r","from-red-500","to-pink-600","rounded-lg","shadow-lg","p-8","text-white","mb-6"],[1,"flex","items-center","justify-between"],[1,"text-4xl","font-bold","mb-2"],[1,"text-xl","opacity-90"],[1,"text-sm","opacity-80","mt-2"],[1,"text-right"],[1,"text-6xl","opacity-20"],[1,"bg-white","rounded-lg","shadow-sm","p-6","mb-6"],[1,"text-lg","font-semibold","text-gray-900","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"w-full","border","border-gray-300","rounded-md","px-3","py-2","text-sm","focus:ring-2","focus:ring-primary-500","focus:border-transparent",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","number","placeholder","0",1,"w-full","border","border-gray-300","rounded-md","px-3","py-2","text-sm","focus:ring-2","focus:ring-primary-500","focus:border-transparent",3,"ngModelChange","change","ngModel"],["type","number","placeholder","999999",1,"w-full","border","border-gray-300","rounded-md","px-3","py-2","text-sm","focus:ring-2","focus:ring-primary-500","focus:border-transparent",3,"ngModelChange","change","ngModel"],["value","name"],["value","price_asc"],["value","price_desc"],["value","newest"],[1,"mt-4","flex","justify-end"],[1,"text-sm","text-gray-600","hover:text-gray-900","transition-colors",3,"click"],["class","flex justify-center items-center py-12",4,"ngIf"],["class","bg-red-50 border border-red-200 rounded-lg p-6 text-center",4,"ngIf"],["class","bg-white rounded-lg shadow-sm p-6",4,"ngIf"],["class","bg-white rounded-lg shadow-sm p-12 text-center",4,"ngIf"],[3,"value"],[1,"flex","justify-center","items-center","py-12"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-primary-600"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-6","text-center"],[1,"text-red-600","mb-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","mx-auto"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-lg","font-medium","text-gray-900","mb-2"],[1,"text-gray-600","mb-4"],[1,"bg-primary-600","text-white","px-4","py-2","rounded-md","hover:bg-primary-700","transition-colors",3,"click"],[1,"bg-white","rounded-lg","shadow-sm","p-6"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-xl","font-bold","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","gap-6"],["class","bg-white border border-gray-200 rounded-lg overflow-hidden hover:shadow-lg transition-shadow relative",4,"ngFor","ngForOf"],["class","mt-8 flex justify-center",4,"ngIf"],[1,"bg-white","border","border-gray-200","rounded-lg","overflow-hidden","hover:shadow-lg","transition-shadow","relative"],[1,"absolute","top-2","left-2","bg-red-500","text-white","px-2","py-1","rounded-full","text-xs","font-bold","z-10"],[1,"aspect-w-1","aspect-h-1","bg-gray-200"],[1,"w-full","h-48","object-cover",3,"src","alt"],[1,"p-4"],[1,"text-lg","font-medium","text-gray-900","mb-2","line-clamp-2"],[1,"text-sm","text-gray-600","mb-2"],[1,"text-sm","text-gray-600","mb-3","line-clamp-2"],[1,"flex","flex-col"],[1,"text-2xl","font-bold","text-red-600"],[1,"text-sm","text-gray-500","line-through"],[1,"bg-red-600","text-white","px-4","py-2","rounded-md","hover:bg-red-700","disabled:bg-gray-400","disabled:cursor-not-allowed","transition-colors","text-sm","font-medium",3,"click","disabled"],[1,"mt-2","text-xs","text-gray-500"],[1,"mt-8","flex","justify-center"],[1,"flex","items-center","space-x-2"],[1,"px-3","py-2","rounded-md","text-sm","font-medium","text-gray-500","hover:text-gray-700","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["class","px-3 py-2 rounded-md text-sm font-medium hover:bg-primary-600 hover:text-white transition-colors",3,"bg-primary-600","text-white","text-gray-700","click",4,"ngFor","ngForOf"],[1,"px-3","py-2","rounded-md","text-sm","font-medium","hover:bg-primary-600","hover:text-white","transition-colors",3,"click"],[1,"bg-white","rounded-lg","shadow-sm","p-12","text-center"],[1,"text-gray-400","mb-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-16","h-16","mx-auto"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"],[1,"text-gray-600","mb-6"],[1,"bg-primary-600","text-white","px-6","py-3","rounded-md","hover:bg-primary-700","transition-colors","font-medium",3,"click"]],template:function(e,r){e&1&&(t(0,"div",0)(1,"div",1)(2,"nav",2)(3,"a",3),o(4,"Inicio"),i(),t(5,"span"),o(6,"/"),i(),t(7,"span",4),o(8,"Ofertas"),i()(),t(9,"div",5)(10,"div",6)(11,"div")(12,"h1",7),o(13,"\u{1F525} Ofertas Especiales"),i(),t(14,"p",8),o(15,"\xA1Aprovecha estos descuentos incre\xEDbles!"),i(),t(16,"p",9),o(17,"Por tiempo limitado"),i()(),t(18,"div",10)(19,"div",11),o(20,"%"),i()()()()(),t(21,"div",12)(22,"h2",13),o(23,"Filtros"),i(),t(24,"div",14)(25,"div")(26,"label",15),o(27,"Categor\xEDa"),i(),t(28,"select",16),w("ngModelChange",function(d){return C(r.filters.category_id,d)||(r.filters.category_id=d),d}),m("change",function(){return r.onFilterChange()}),t(29,"option",17),o(30,"Todas las categor\xEDas"),i(),_(31,Z,2,2,"option",18),i()(),t(32,"div")(33,"label",15),o(34,"Precio m\xEDnimo"),i(),t(35,"input",19),w("ngModelChange",function(d){return C(r.filters.min_price,d)||(r.filters.min_price=d),d}),m("change",function(){return r.onFilterChange()}),i()(),t(36,"div")(37,"label",15),o(38,"Precio m\xE1ximo"),i(),t(39,"input",20),w("ngModelChange",function(d){return C(r.filters.max_price,d)||(r.filters.max_price=d),d}),m("change",function(){return r.onFilterChange()}),i()(),t(40,"div")(41,"label",15),o(42,"Ordenar por"),i(),t(43,"select",16),w("ngModelChange",function(d){return C(r.sortBy,d)||(r.sortBy=d),d}),m("change",function(){return r.onSortChange()}),t(44,"option",21),o(45,"Nombre"),i(),t(46,"option",22),o(47,"Precio: Menor a Mayor"),i(),t(48,"option",23),o(49,"Precio: Mayor a Menor"),i(),t(50,"option",24),o(51,"M\xE1s Recientes"),i()()()(),t(52,"div",25)(53,"button",26),m("click",function(){return r.clearFilters()}),o(54," Limpiar filtros "),i()()(),_(55,$,2,0,"div",27)(56,ee,10,1,"div",28)(57,ne,9,5,"div",29)(58,oe,10,0,"div",30),i()),e&2&&(a(28),y("ngModel",r.filters.category_id),a(3),c("ngForOf",r.categories()),a(4),y("ngModel",r.filters.min_price),a(4),y("ngModel",r.filters.max_price),a(4),y("ngModel",r.sortBy),a(12),c("ngIf",r.loading()),a(),c("ngIf",r.error()),a(),c("ngIf",!r.loading()&&!r.error()&&r.products().length>0),a(),c("ngIf",!r.loading()&&!r.error()&&r.products().length===0))},dependencies:[B,D,N,X,K,Q,z,U,J,G,H,A,W,j],encapsulation:2})};export{Y as OffersComponent};
