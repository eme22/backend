import{h as z}from"./chunk-7T4FWYSB.js";import{a as G}from"./chunk-6OEF5Y2I.js";import{a as re}from"./chunk-OJ52E7LM.js";import{b as $,c as g,d as Y,e as J,h as K,j as Q,k as W,l as X,m as Z,n as ee,o as te,r as ie,t as ne}from"./chunk-TPTRQRQT.js";import{a as U}from"./chunk-PWJAWN2C.js";import{c as j,d as H,g as L}from"./chunk-5NKQJYQU.js";import"./chunk-KL4PSEE7.js";import{$ as I,Ga as T,Gb as i,Ia as a,Ib as _,Jb as V,Oa as v,Tb as y,Ub as h,Va as N,Za as p,_ as F,aa as S,ba as E,ia as C,jb as D,kb as P,lb as d,mb as t,nb as e,ob as c,rc as A,sc as O,ub as q,uc as B,wb as M,xb as x,xc as R}from"./chunk-HE7H4WY4.js";function le(n,r){n&1&&(t(0,"div",6),c(1,"div",7),t(2,"p",8),i(3,"Cargando informaci\xF3n..."),e()())}function ae(n,r){n&1&&(t(0,"div",6)(1,"div",9),i(2,"\u{1F6D2}"),e(),t(3,"h2",10),i(4,"Tu carrito est\xE1 vac\xEDo"),e(),t(5,"p",11),i(6,"No puedes proceder al pago sin productos"),e(),t(7,"button",12),i(8," Continuar Comprando "),e()())}function me(n,r){n&1&&(t(0,"div",64),i(1," La direcci\xF3n es requerida "),e())}function de(n,r){n&1&&(t(0,"div",64),i(1," La ciudad es requerida "),e())}function ce(n,r){n&1&&(t(0,"div",64),i(1," El estado es requerido "),e())}function pe(n,r){n&1&&(t(0,"div",64),i(1," El c\xF3digo postal es requerido "),e())}function ue(n,r){n&1&&(t(0,"div",64),i(1," El pa\xEDs es requerido "),e())}function se(n,r){n&1&&(t(0,"div",64),i(1," Ingresa un email v\xE1lido "),e())}function ge(n,r){if(n&1&&(t(0,"div",19)(1,"label",20),i(2," Email (opcional) "),e(),c(3,"input",65),p(4,se,2,0,"div",22),e()),n&2){let o,l=x(2);a(4),d("ngIf",((o=l.checkoutForm.get("email"))==null?null:o.invalid)&&((o=l.checkoutForm.get("email"))==null?null:o.touched))}}function ve(n,r){n&1&&(t(0,"div",66),c(1,"input",67),t(2,"p",68),i(3," Email asociado a tu cuenta de PayPal "),e()())}function fe(n,r){n&1&&(t(0,"div",74)(1,"p",77),i(2," Usa el n\xFAmero "),t(3,"strong"),i(4,"999999999"),e(),i(5," para enviar tu pago a Yape. "),e()())}function xe(n,r){n&1&&(t(0,"div",75)(1,"p",63),i(2," Usa el n\xFAmero "),t(3,"strong"),i(4,"999999999"),e(),i(5," para enviar tu pago a Plin. "),e()())}function _e(n,r){n&1&&(t(0,"div",76)(1,"p",78),i(2," Usa el n\xFAmero "),t(3,"strong"),i(4,"999999999"),e(),i(5," para enviar tu pago a Bim. "),e()())}function ye(n,r){if(n&1&&(t(0,"div",69)(1,"select",70)(2,"option",27),i(3,"Seleccionar tipo de billetera"),e(),t(4,"option",71),i(5,"Yape"),e(),t(6,"option",72),i(7,"Plin"),e(),t(8,"option",73),i(9,"Bim"),e()(),D(10,fe,6,0,"div",74)(11,xe,6,0,"div",75)(12,_e,6,0,"div",76),e()),n&2){let o,l=x(2);a(10),P(((o=l.checkoutForm.get("wallet_type"))==null?null:o.value)==="yape"?10:((o=l.checkoutForm.get("wallet_type"))==null?null:o.value)==="plin"?11:((o=l.checkoutForm.get("wallet_type"))==null?null:o.value)==="bim"?12:-1)}}function he(n,r){n&1&&(t(0,"div",79),i(1," Selecciona un m\xE9todo de pago "),e())}function be(n,r){n&1&&(t(0,"span"),i(1,"Realizar Pedido"),e())}function Se(n,r){n&1&&(t(0,"span",80),S(),t(1,"svg",81),c(2,"circle",82)(3,"path",83),e(),i(4," Procesando... "),e())}function Ce(n,r){if(n&1&&(t(0,"div",84),c(1,"img",85),t(2,"div",86)(3,"p",87),i(4),e(),t(5,"p",88),i(6),y(7,"number"),e()(),t(8,"p",58),i(9),y(10,"number"),e()()),n&2){let o=r.$implicit;a(),d("src",(o.product==null||o.product.images==null||o.product.images[0]==null?null:o.product.images[0].image_url)||"/placeholder-product.jpg",T)("alt",(o.product==null?null:o.product.name)||"Producto"),a(3),_(" ",(o.product==null?null:o.product.name)||"Producto"," "),a(2),V(" ",o.quantity," x ","$"+h(7,6,o.price,"1.2-2")," "),a(3),_(" ","$"+h(10,9,o.price*o.quantity,"1.2-2")," ")}}function Ee(n,r){if(n&1){let o=q();t(0,"div",13)(1,"div",14)(2,"form",15),M("ngSubmit",function(){F(o);let u=x();return I(u.onSubmit())}),t(3,"div",16)(4,"h3",17),i(5,"Direcci\xF3n de Env\xEDo"),e(),t(6,"div",18)(7,"div",19)(8,"label",20),i(9," Direcci\xF3n * "),e(),c(10,"input",21),p(11,me,2,0,"div",22),e(),t(12,"div")(13,"label",20),i(14," Ciudad * "),e(),c(15,"input",23),p(16,de,2,0,"div",22),e(),t(17,"div")(18,"label",20),i(19," Estado/Provincia * "),e(),c(20,"input",24),p(21,ce,2,0,"div",22),e(),t(22,"div")(23,"label",20),i(24," C\xF3digo Postal * "),e(),c(25,"input",25),p(26,pe,2,0,"div",22),e(),t(27,"div")(28,"label",20),i(29," Pa\xEDs * "),e(),t(30,"select",26)(31,"option",27),i(32,"Seleccionar pa\xEDs"),e(),t(33,"option",28),i(34,"Per\xFA"),e()(),p(35,ue,2,0,"div",22),e(),p(36,ge,5,1,"div",29),e()(),t(37,"div",16)(38,"h3",17),i(39,"M\xE9todo de Pago"),e(),t(40,"div",30)(41,"div",31),c(42,"input",32),t(43,"label",33),S(),t(44,"svg",34),c(45,"path",35)(46,"path",36),e(),E(),t(47,"span",37),i(48,"PayPal"),e()()(),p(49,ve,4,0,"div",38),t(50,"div",31),c(51,"input",39),t(52,"label",40),S(),t(53,"svg",41),c(54,"path",42),e(),E(),t(55,"span",37),i(56,"Billetera Electr\xF3nica"),e()()(),p(57,ye,13,1,"div",43),e(),p(58,he,2,0,"div",44),e(),t(59,"div",16)(60,"h3",17),i(61,"Notas Adicionales"),e(),c(62,"textarea",45),e(),t(63,"div",46)(64,"button",47),p(65,be,2,0,"span",48)(66,Se,5,0,"span",49),e(),t(67,"button",50),i(68," Volver al Carrito "),e()()()(),t(69,"div",51)(70,"div",52)(71,"h3",17),i(72,"Resumen del Pedido"),e(),t(73,"div",53),p(74,Ce,11,12,"div",54),e(),t(75,"div",55)(76,"div",56)(77,"span",57),i(78,"Subtotal:"),e(),t(79,"span",58),i(80),y(81,"number"),e()(),t(82,"div",56)(83,"span",57),i(84,"Env\xEDo:"),e(),t(85,"span",58),i(86,"A calcular"),e()(),t(87,"div",59)(88,"span",60),i(89,"Total:"),e(),t(90,"span",61),i(91),y(92,"number"),e()()(),t(93,"div",62)(94,"p",63)(95,"strong"),i(96,"Nota:"),e(),i(97," Tu pedido ser\xE1 procesado manualmente. Recibir\xE1s instrucciones de pago por email. "),e()()()()()}if(n&2){let o,l,u,s,f,k,w,b,m=x();a(2),d("formGroup",m.checkoutForm),a(9),d("ngIf",((o=m.checkoutForm.get("street"))==null?null:o.invalid)&&((o=m.checkoutForm.get("street"))==null?null:o.touched)),a(5),d("ngIf",((l=m.checkoutForm.get("city"))==null?null:l.invalid)&&((l=m.checkoutForm.get("city"))==null?null:l.touched)),a(5),d("ngIf",((u=m.checkoutForm.get("state"))==null?null:u.invalid)&&((u=m.checkoutForm.get("state"))==null?null:u.touched)),a(5),d("ngIf",((s=m.checkoutForm.get("postal_code"))==null?null:s.invalid)&&((s=m.checkoutForm.get("postal_code"))==null?null:s.touched)),a(9),d("ngIf",((f=m.checkoutForm.get("country"))==null?null:f.invalid)&&((f=m.checkoutForm.get("country"))==null?null:f.touched)),a(),d("ngIf",!m.isLoggedIn()),a(13),d("ngIf",((k=m.checkoutForm.get("payment_method"))==null?null:k.value)==="paypal"),a(8),d("ngIf",((w=m.checkoutForm.get("payment_method"))==null?null:w.value)==="electronic_wallet"),a(),d("ngIf",((b=m.checkoutForm.get("payment_method"))==null?null:b.invalid)&&((b=m.checkoutForm.get("payment_method"))==null?null:b.touched)),a(6),d("disabled",m.checkoutForm.invalid||m.submitting()),a(),d("ngIf",!m.submitting()),a(),d("ngIf",m.submitting()),a(8),d("ngForOf",m.cart().items),a(6),_(" ","$"+h(81,16,m.cart().total,"1.2-2")," "),a(11),_(" ","$"+h(92,19,m.cart().total,"1.2-2")," ")}}var oe=class n{constructor(r,o,l,u,s,f){this.cartService=r;this.ordersService=o;this.fb=l;this.router=u;this.authService=s;this.toastrService=f;this.checkoutForm=this.fb.group({street:["",[g.required]],city:["",[g.required]],state:["",[g.required]],postal_code:["",[g.required]],country:["",[g.required]],payment_method:["",[g.required]],paypal_email:[""],wallet_type:[""],wallet_address:[""],notes:[""],email:["",[g.email]]})}cart=C(null);loading=C(!1);submitting=C(!1);checkoutForm;ngOnInit(){this.loadCart()}isLoggedIn(){return this.authService.isAuthenticated()}loadCart(){this.loading.set(!0),this.cartService.getCart().subscribe({next:r=>{this.cart.set(r),this.loading.set(!1)},error:r=>{console.error("Error loading cart:",r),this.loading.set(!1)}})}onSubmit(){if(this.checkoutForm.valid&&this.cart()){this.submitting.set(!0),console.log("Checkout Form Value:",this.checkoutForm.value),console.log("Cart Items:",this.cart().items),console.log("Cart Total:",this.cart().total),console.log("User ID:",this.authService.getUserId());let r=this.checkoutForm.value,o={shipping_address:JSON.stringify({street:r.street,city:r.city,state:r.state,postal_code:r.postal_code,country:r.country}),items:this.cart().items.map(l=>({product_id:l.product_id,quantity:l.quantity,price:l.price,subtotal:l.price*l.quantity})),payment_method:r.payment_method,notes:r.notes,user_email:r.email||void 0};r.payment_method==="paypal"&&r.paypal_email?o.payment_details={paypal_email:r.paypal_email}:r.payment_method==="electronic_wallet"&&(o.payment_details={wallet_type:r.wallet_type,wallet_address:r.wallet_address}),this.ordersService.createOrder(o).subscribe({next:l=>{this.submitting.set(!1),this.router.navigate(["/order-confirmation",l.order_id])},error:l=>{console.error("Error creating order:",l),this.submitting.set(!1),this.toastrService.error("Error al procesar el pedido. Int\xE9ntalo de nuevo m\xE1s tarde.","Error")}})}}static \u0275fac=function(o){return new(o||n)(v(U),v(re),v(ie),v(j),v(G),v(z))};static \u0275cmp=N({type:n,selectors:[["app-checkout"]],decls:8,vars:3,consts:[[1,"max-w-4xl","mx-auto","px-4","sm:px-6","lg:px-8","py-8"],[1,"bg-white","rounded-lg","shadow-sm"],[1,"px-6","py-4","border-b","border-gray-200"],[1,"text-2xl","font-bold","text-gray-900"],["class","px-6 py-12 text-center",4,"ngIf"],["class","grid grid-cols-1 lg:grid-cols-3 gap-8 p-6",4,"ngIf"],[1,"px-6","py-12","text-center"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-primary-600","mx-auto"],[1,"mt-4","text-gray-500"],[1,"text-6xl","text-gray-400","mb-4"],[1,"text-xl","font-medium","text-gray-900","mb-2"],[1,"text-gray-500","mb-6"],["routerLink","/",1,"bg-primary-600","text-white","px-6","py-3","rounded-md","hover:bg-primary-700","transition-colors","font-medium"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-8","p-6"],[1,"lg:col-span-2"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"bg-gray-50","rounded-lg","p-6"],[1,"text-lg","font-medium","text-gray-900","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"md:col-span-2"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","formControlName","street","placeholder","Calle, n\xFAmero, apartamento",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:border-transparent"],["class","text-red-600 text-sm mt-1",4,"ngIf"],["type","text","formControlName","city","placeholder","Ciudad",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:border-transparent"],["type","text","formControlName","state","placeholder","Estado o Provincia",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:border-transparent"],["type","text","formControlName","postal_code","placeholder","12345",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:border-transparent"],["formControlName","country",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:border-transparent"],["value",""],["value","PE"],["class","md:col-span-2",4,"ngIf"],[1,"space-y-4"],[1,"flex","items-center"],["id","paypal","type","radio","value","paypal","formControlName","payment_method",1,"w-4","h-4","text-primary-600","border-gray-300","focus:ring-primary-500"],["for","paypal",1,"ml-3","flex","items-center","cursor-pointer"],["viewBox","0 0 24 24","fill","none",1,"w-8","h-8","mr-2"],["d","M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944 1.039c.033-.4.38-.7.781-.7h8.68c2.829 0 5.464 1.621 5.464 4.731 0 2.829-2.016 5.1-4.731 5.1H9.563l-.84 5.4c-.022.335-.314.605-.652.605H7.076z","fill","#0070BA"],["d","M23.154 9.897c-.916 5.099-4.731 8.297-9.563 8.297H9.563c-.335 0-.629-.27-.652-.605l-1.099-7.084c-.033-.4.271-.733.672-.733h4.398c4.398 0 7.084-2.686 7.084-7.084 0-.629-.067-1.223-.189-1.817.78 1.256 1.256 2.829 1.256 4.731 0 1.495-.335 2.829-.879 4.295z","fill","#003087"],[1,"text-gray-900","font-medium"],["class","ml-7 mt-2",4,"ngIf"],["id","electronic_wallet","type","radio","value","electronic_wallet","formControlName","payment_method",1,"w-4","h-4","text-primary-600","border-gray-300","focus:ring-primary-500"],["for","electronic_wallet",1,"ml-3","flex","items-center","cursor-pointer"],["fill","currentColor","viewBox","0 0 24 24",1,"w-8","h-8","mr-2","text-green-600"],["d","M21 18v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v1M7 9h10v6H7V9zm2 2v2h6v-2H9z"],["class","ml-7 mt-2 space-y-3",4,"ngIf"],["class","text-red-600 text-sm mt-2",4,"ngIf"],["formControlName","notes","rows","3","placeholder","Instrucciones especiales para el vendedor (opcional)",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:border-transparent"],[1,"flex","space-x-4"],["type","submit",1,"flex-1","bg-green-600","text-white","py-3","px-6","rounded-md","hover:bg-green-700","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors","font-medium","text-lg",3,"disabled"],[4,"ngIf"],["class","flex items-center justify-center",4,"ngIf"],["type","button","routerLink","/cart",1,"flex-1","bg-gray-200","text-gray-700","py-3","px-6","rounded-md","hover:bg-gray-300","transition-colors","font-medium","text-lg"],[1,"lg:col-span-1"],[1,"bg-gray-50","rounded-lg","p-6","sticky","top-6"],[1,"space-y-3","mb-4"],["class","flex items-center space-x-3",4,"ngFor","ngForOf"],[1,"border-t","border-gray-200","pt-4"],[1,"flex","justify-between","items-center","mb-2"],[1,"text-sm","text-gray-600"],[1,"text-sm","font-medium","text-gray-900"],[1,"flex","justify-between","items-center","pt-2","border-t","border-gray-200"],[1,"text-lg","font-medium","text-gray-900"],[1,"text-xl","font-bold","text-primary-600"],[1,"mt-4","p-3","bg-blue-50","rounded-md"],[1,"text-sm","text-blue-800"],[1,"text-red-600","text-sm","mt-1"],["type","email","formControlName","email","placeholder","Correo electr\xF3nico",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:border-transparent"],[1,"ml-7","mt-2"],["type","email","formControlName","paypal_email","placeholder","tu-email@paypal.com",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:border-transparent"],[1,"text-sm","text-gray-500","mt-1"],[1,"ml-7","mt-2","space-y-3"],["formControlName","wallet_type",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:border-transparent"],["value","yape"],["value","plin"],["value","bim"],[1,"bg-yellow-50","p-4","rounded-md"],[1,"bg-blue-50","p-4","rounded-md"],[1,"bg-gray-50","p-4","rounded-md"],[1,"text-sm","text-yellow-800"],[1,"text-sm","text-gray-800"],[1,"text-red-600","text-sm","mt-2"],[1,"flex","items-center","justify-center"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","-ml-1","mr-3","h-5","w-5","text-white"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"flex","items-center","space-x-3"],[1,"w-12","h-12","object-cover","rounded-md",3,"src","alt"],[1,"flex-1","min-w-0"],[1,"text-sm","font-medium","text-gray-900","truncate"],[1,"text-sm","text-gray-500"]],template:function(o,l){if(o&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),i(4,"Finalizar Compra"),e()(),p(5,le,4,0,"div",4)(6,ae,9,0,"div",4)(7,Ee,98,22,"div",5),e()()),o&2){let u,s;a(5),d("ngIf",l.loading()),a(),d("ngIf",!l.loading()&&(!((u=l.cart())!=null&&u.items)||l.cart().items.length===0)),a(),d("ngIf",!l.loading()&&((s=l.cart())==null?null:s.items)&&l.cart().items.length>0)}},dependencies:[R,A,O,L,H,ne,K,ee,te,$,Z,Q,Y,J,W,X,B],encapsulation:2})};export{oe as CheckoutComponent};
