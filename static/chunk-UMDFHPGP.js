import{a as w}from"./chunk-G4EWZ63B.js";import{a as B}from"./chunk-PPJNTKAE.js";import{c as P}from"./chunk-W47PZQCQ.js";import{h as N}from"./chunk-7T4FWYSB.js";import{b as R,d as W,g as V,m as j,n as F,o as L,s as O}from"./chunk-TPTRQRQT.js";import"./chunk-KL4PSEE7.js";import{$ as h,Eb as b,Fc as k,Gb as s,Hb as C,Ia as a,Ib as c,Ic as U,Kb as v,Lb as x,Mb as _,Oa as u,Va as E,Za as y,_ as f,ia as p,lb as S,mb as i,nb as r,ob as M,rc as A,sc as I,ub as T,wb as d,xb as g,xc as D}from"./chunk-HE7H4WY4.js";function H(m,t){if(m&1){let e=T();i(0,"tr")(1,"td",22)(2,"div",23)(3,"div",24)(4,"span",25),s(5),r()(),i(6,"div",26)(7,"div",27),s(8),r()()()(),i(9,"td",28),s(10),r(),i(11,"td",22)(12,"span",29),s(13),r()(),i(14,"td",22)(15,"span",29),s(16),r()(),i(17,"td",28),s(18),r(),i(19,"td",30)(20,"button",31),d("click",function(){let l=f(e).$implicit,o=g();return h(o.editUser(l))}),s(21," Editar "),r(),i(22,"button",32),d("click",function(){let l=f(e).$implicit,o=g();return h(o.toggleUserStatus(l))}),s(23),r(),i(24,"button",33),d("click",function(){let l=f(e).$implicit,o=g();return h(o.deleteUser(l))}),s(25," Eliminar "),r()()()}if(m&2){let e=t.$implicit,n=g();a(5),C(e.username.charAt(0).toUpperCase()),a(3),C(e.username),a(2),c(" ",e.email," "),a(2),b("bg-red-100",e.role==="admin")("text-red-800",e.role==="admin")("bg-blue-100",e.role==="vendor")("text-blue-800",e.role==="vendor")("bg-green-100",e.role==="customer")("text-green-800",e.role==="customer"),a(),c(" ",e.role," "),a(2),b("bg-green-100",e.is_active)("text-green-800",e.is_active)("bg-red-100",!e.is_active)("text-red-800",!e.is_active),a(),c(" ",e.is_active?"Activo":"Inactivo"," "),a(2),c(" ",n.formatDate(e.created_at)," "),a(5),c(" ",e.is_active?"Desactivar":"Activar"," ")}}function z(m,t){m&1&&(i(0,"div",34),M(1,"div",35),r())}var $=class m{constructor(t,e,n,l){this.http=t;this.dialog=e;this.toastr=n;this.confirmationService=l}users=p([]);filteredUsers=p([]);loading=p(!1);error=p(null);searchTerm="";selectedRole="";selectedStatus="";ngOnInit(){this.loadUsers()}openCreateModal(){this.dialog.open(w,{data:{mode:"create"},width:"500px",maxWidth:"90vw"}).closed.subscribe(e=>{e&&(this.loadUsers(),this.toastr.success("Usuario creado exitosamente","\xC9xito"))})}editUser(t){this.dialog.open(w,{data:{user:t,mode:"edit"},width:"500px",maxWidth:"90vw"}).closed.subscribe(n=>{n&&(this.loadUsers(),this.toastr.success("Usuario actualizado exitosamente","\xC9xito"))})}loadUsers(){this.loading.set(!0),this.http.get(`${U.apiUrl}/users`).subscribe({next:t=>{this.users.set(t),this.filteredUsers.set(t),this.loading.set(!1)},error:t=>{this.error.set("Error loading users"),this.loading.set(!1),console.error("Error loading users:",t)}})}filterUsers(){let t=this.users();if(this.searchTerm&&(t=t.filter(e=>e.username.toLowerCase().includes(this.searchTerm.toLowerCase())||e.email.toLowerCase().includes(this.searchTerm.toLowerCase()))),this.selectedRole&&(t=t.filter(e=>e.role===this.selectedRole)),this.selectedStatus){let e=this.selectedStatus==="active";t=t.filter(n=>n.is_active===e)}this.filteredUsers.set(t)}toggleUserStatus(t){this.http.patch(`${U.apiUrl}/users/${t.user_id}/status`,{is_active:!t.is_active}).subscribe({next:()=>{t.is_active=!t.is_active,this.filteredUsers.set([...this.filteredUsers()]),this.toastr.success(`Usuario ${t.is_active?"activado":"desactivado"} exitosamente`,"\xC9xito")},error:e=>{console.error("Error updating user status:",e),this.toastr.error("Error al actualizar el estado del usuario","Error")}})}deleteUser(t){this.confirmationService.delete("usuario").subscribe(e=>{e&&this.http.delete(`${U.apiUrl}/users/${t.user_id}`).subscribe({next:()=>{this.loadUsers(),this.toastr.success("Usuario eliminado exitosamente","\xC9xito")},error:n=>{console.error("Error deleting user:",n),this.toastr.error("Error al eliminar el usuario","Error")}})})}formatDate(t){return new Date(t).toLocaleDateString("es-ES")}static \u0275fac=function(e){return new(e||m)(u(k),u(P),u(N),u(B))};static \u0275cmp=E({type:m,selectors:[["app-admin-users"]],decls:45,vars:5,consts:[[1,"p-6"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"bg-primary-600","text-white","px-4","py-2","rounded-lg","hover:bg-primary-700","transition-colors",3,"click"],[1,"bg-white","p-4","rounded-lg","shadow","mb-6"],[1,"flex","flex-wrap","gap-4"],["type","text","placeholder","Buscar usuarios...",1,"px-4","py-2","border","rounded-lg","focus:ring-2","focus:ring-primary-500","focus:border-transparent",3,"ngModelChange","input","ngModel"],[1,"px-4","py-2","border","rounded-lg","focus:ring-2","focus:ring-primary-500","focus:border-transparent",3,"ngModelChange","change","ngModel"],["value",""],["value","admin"],["value","vendor"],["value","customer"],["value","active"],["value","inactive"],[1,"bg-white","rounded-lg","shadow","overflow-hidden"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-50"],[1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"bg-white","divide-y","divide-gray-200"],[4,"ngFor","ngForOf"],["class","flex justify-center py-8",4,"ngIf"],[1,"px-6","py-4","whitespace-nowrap"],[1,"flex","items-center"],[1,"w-8","h-8","bg-primary-600","rounded-full","flex","items-center","justify-center"],[1,"text-white","text-sm","font-medium"],[1,"ml-4"],[1,"text-sm","font-medium","text-gray-900"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-gray-900"],[1,"px-2","py-1","text-xs","font-medium","rounded-full"],[1,"px-6","py-4","whitespace-nowrap","text-sm","font-medium"],[1,"text-primary-600","hover:text-primary-900","mr-3",3,"click"],[1,"text-yellow-600","hover:text-yellow-900","mr-3",3,"click"],[1,"text-red-600","hover:text-red-900",3,"click"],[1,"flex","justify-center","py-8"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-primary-600"]],template:function(e,n){e&1&&(i(0,"div",0)(1,"div",1)(2,"h1",2),s(3,"Gesti\xF3n de Usuarios"),r(),i(4,"button",3),d("click",function(){return n.openCreateModal()}),s(5," Crear Usuario "),r()(),i(6,"div",4)(7,"div",5)(8,"input",6),_("ngModelChange",function(o){return x(n.searchTerm,o)||(n.searchTerm=o),o}),d("input",function(){return n.filterUsers()}),r(),i(9,"select",7),_("ngModelChange",function(o){return x(n.selectedRole,o)||(n.selectedRole=o),o}),d("change",function(){return n.filterUsers()}),i(10,"option",8),s(11,"Todos los roles"),r(),i(12,"option",9),s(13,"Admin"),r(),i(14,"option",10),s(15,"Vendor"),r(),i(16,"option",11),s(17,"Customer"),r()(),i(18,"select",7),_("ngModelChange",function(o){return x(n.selectedStatus,o)||(n.selectedStatus=o),o}),d("change",function(){return n.filterUsers()}),i(19,"option",8),s(20,"Todos los estados"),r(),i(21,"option",12),s(22,"Activo"),r(),i(23,"option",13),s(24,"Inactivo"),r()()()(),i(25,"div",14)(26,"div",15)(27,"table",16)(28,"thead",17)(29,"tr")(30,"th",18),s(31," Usuario "),r(),i(32,"th",18),s(33," Email "),r(),i(34,"th",18),s(35," Rol "),r(),i(36,"th",18),s(37," Estado "),r(),i(38,"th",18),s(39," Fecha de Registro "),r(),i(40,"th",18),s(41," Acciones "),r()()(),i(42,"tbody",19),y(43,H,26,27,"tr",20),r()()()(),y(44,z,2,0,"div",21),r()),e&2&&(a(8),v("ngModel",n.searchTerm),a(),v("ngModel",n.selectedRole),a(9),v("ngModel",n.selectedStatus),a(25),S("ngForOf",n.filteredUsers()),a(),S("ngIf",n.loading()))},dependencies:[D,A,I,O,F,L,R,j,W,V],encapsulation:2})};export{$ as AdminUsersComponent};
