import{a as re,b as ie}from"./chunk-LTQIWH4L.js";import{h as A}from"./chunk-HYBTYU64.js";import{a as B,b as O,d as H,e as G,f as z,g as K,h as J,i as Q,m as X,n as Y,o as Z,p as $,q as ee,s as te}from"./chunk-3BSRKISZ.js";import{$ as E,Cb as j,Fc as V,Ga as M,Gb as s,Ia as d,Ib as x,Ic as b,Kb as m,Lb as p,Mb as u,Oa as h,Ob as N,Va as D,Xb as q,Za as f,_ as I,a as S,aa as k,b as P,ba as T,ia as C,lb as c,mb as i,nb as o,ob as v,rc as L,sc as R,ub as W,w as F,wb as _,xb as y,xc as U}from"./chunk-7IT3E43U.js";function ne(a,l){if(a&1&&(i(0,"option",31),s(1),o()),a&2){let r=l.$implicit;c("value",r.category_id),d(),x(" ",r.name," ")}}function ae(a,l){if(a&1&&v(0,"img",34),a&2){let r=y(2);c("src",r.imagePreview,M)}}function le(a,l){if(a&1&&v(0,"img",36),a&2){let r=y(3);c("src",r.principalImageForm.image_url,M)}}function de(a,l){if(a&1&&f(0,le,1,1,"img",35),a&2){let r=y(2);c("ngIf",r.imagePreview)}}function se(a,l){if(a&1&&(i(0,"div",32),f(1,ae,1,1,"img",33)(2,de,1,1,"ng-template",null,0,q),o()),a&2){let r=j(3),t=y();d(),c("ngIf",t.imagePreview)("ngIfElse",r)}}function ce(a,l){if(a&1){let r=W();i(0,"div",37),v(1,"img",38),i(2,"button",39),_("click",function(){let n=I(r).index,e=y();return E(e.removeSecondaryImage(n))}),s(3,"\xD7"),o()()}if(a&2){let r=l.$implicit,t=l.index;d(),c("alt",N("Secundaria ",t+1))("src",r,M)}}function me(a,l){if(a&1&&(i(0,"div",40),s(1),o()),a&2){let r=y();d(),x(" ",r.error()," ")}}var oe=class a{constructor(l,r,t,n){this.dialogRef=l;this.data=r;this.http=t;this.toastrService=n;r.mode==="edit"&&r.product&&(this.productForm={name:r.product.name,description:r.product.description||"",price:r.product.price,sku:r.product.sku||"",stock_quantity:r.product.stock_quantity,category_id:r.product.category_id.toString(),is_active:r.product.is_active},this.principalImageForm.image_url=r.product.images.find(e=>e.is_primary)?.image_url||"",this.imagePreview=this.principalImageForm.image_url,this.secondaryImagePreviews=r.product.images.filter(e=>!e.is_primary).map(e=>e.image_url))}loading=C(!1);error=C(null);imagePreview=null;secondaryImagePreviews=[];productForm={name:"",description:"",price:0,sku:"",stock_quantity:0,category_id:"",is_active:!0};principalImageForm={image_url:""};secondaryImageForm={secondary_images:[]};onSecondaryFilesSelected(l){let r=l.target;if(!r.files||r.files.length===0)return;let t=Array.from(r.files);for(let n of t){let e=new FileReader;e.onload=w=>{this.secondaryImagePreviews.push(w.target.result)},e.readAsDataURL(n);let g=new FormData;g.append("file",n),this.loading.set(!0),this.http.post(`${b.apiUrl}/upload`,g).subscribe({next:w=>{this.loading.set(!1),this.secondaryImageForm.secondary_images.push(w.url)},error:w=>{this.loading.set(!1),this.toastrService.error("Error al subir imagen secundaria","Error")}})}}removeSecondaryImage(l){this.secondaryImagePreviews.splice(l,1),this.secondaryImageForm.secondary_images.splice(l,1)}closeModal(){this.dialogRef.close()}onFileSelected(l){let r=l.target;if(!r.files||r.files.length===0)return;let t=r.files[0],n=new FileReader;n.onload=g=>{this.imagePreview=g.target.result},n.readAsDataURL(t);let e=new FormData;e.append("file",t),this.loading.set(!0),this.http.post(`${b.apiUrl}/upload`,e).subscribe({next:g=>{this.principalImageForm.image_url=g.url,this.loading.set(!1)},error:g=>{this.loading.set(!1),this.toastrService.error("Error al subir la imagen","Error")}})}saveProduct(){this.loading.set(!0),this.error.set(null);let l=P(S({},this.productForm),{category_id:parseInt(this.productForm.category_id)}),r=[{image_url:this.principalImageForm.image_url,is_primary:!0},...this.secondaryImageForm.secondary_images.map(n=>({image_url:n,is_primary:!1}))];(this.data.mode==="create"?this.http.post(`${b.apiUrl}/products`,l):this.http.put(`${b.apiUrl}/products/${this.data.product.product_id}`,l)).subscribe({next:n=>{F(r.map(e=>this.http.post(`${b.apiUrl}/products/${n.product_id}/images`,S({},e)))).subscribe({next:e=>{this.loading.set(!1),this.dialogRef.close(n)},error:e=>{this.loading.set(!1),this.toastrService.error("Error al subir im\xE1genes","Error"),console.error("Error uploading images:",e)}})},error:n=>{this.loading.set(!1),this.toastrService.error(n.error?.message||"Error al guardar producto","Error"),console.error("Error saving product:",n)}})}static \u0275fac=function(r){return new(r||a)(h(re),h(ie),h(V),h(A))};static \u0275cmp=D({type:a,selectors:[["app-product-modal"]],decls:58,vars:14,consts:[["urlPreview",""],[1,"bg-white","rounded-lg","shadow-xl","max-w-lg","w-full","mx-4"],[1,"flex","justify-between","items-center","p-6","border-b"],[1,"text-xl","font-bold","text-gray-900"],[1,"text-gray-400","hover:text-gray-600","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-6","space-y-4",3,"ngSubmit"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","name","name","required","","placeholder","Ingrese nombre del producto",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-primary-500","focus:border-transparent",3,"ngModelChange","ngModel"],["name","description","rows","3","placeholder","Ingrese descripci\xF3n del producto",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-primary-500","focus:border-transparent",3,"ngModelChange","ngModel"],[1,"grid","grid-cols-2","gap-4"],["type","number","name","price","min","0","step","0.01","required","","placeholder","0.00",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-primary-500","focus:border-transparent",3,"ngModelChange","ngModel"],["type","number","name","stock_quantity","min","0","required","","placeholder","0",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-primary-500","focus:border-transparent",3,"ngModelChange","ngModel"],["type","text","name","sku","placeholder","Ingrese SKU del producto (opcional)",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-primary-500","focus:border-transparent",3,"ngModelChange","ngModel"],["name","category_id","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-primary-500","focus:border-transparent",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"flex","items-center","space-x-4"],["class","w-20 h-20 rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center border",4,"ngIf"],["type","file","accept","image/*",1,"block","w-full","text-sm","text-gray-500","file:mr-4","file:py-2","file:px-4","file:rounded-lg","file:border-0","file:text-sm","file:font-semibold","file:bg-primary-50","file:text-primary-700","hover:file:bg-primary-100",3,"change"],["type","file","accept","image/*","multiple","",1,"block","w-full","text-sm","text-gray-500","file:mr-4","file:py-2","file:px-4","file:rounded-lg","file:border-0","file:text-sm","file:font-semibold","file:bg-primary-50","file:text-primary-700","hover:file:bg-primary-100","mb-2",3,"change"],[1,"flex","flex-wrap","gap-3","mt-2"],["class","relative w-16 h-16 rounded-lg overflow-hidden bg-gray-100 border flex items-center justify-center",4,"ngFor","ngForOf"],[1,"flex","items-center"],["type","checkbox","name","is_active","id","is_active",1,"h-4","w-4","text-primary-600","focus:ring-primary-500","border-gray-300","rounded",3,"ngModelChange","ngModel"],["for","is_active",1,"ml-2","block","text-sm","text-gray-900"],["class","text-red-600 text-sm",4,"ngIf"],[1,"flex","justify-end","space-x-3","pt-4"],["type","button",1,"px-4","py-2","text-sm","font-medium","text-gray-700","bg-gray-100","hover:bg-gray-200","rounded-md","transition-colors",3,"click"],["type","submit",1,"px-4","py-2","text-sm","font-medium","text-white","bg-primary-600","hover:bg-primary-700","rounded-md","transition-colors","disabled:opacity-50",3,"disabled"],[3,"value"],[1,"w-20","h-20","rounded-lg","overflow-hidden","bg-gray-100","flex","items-center","justify-center","border"],["alt","Preview","class","object-cover w-full h-full",3,"src",4,"ngIf","ngIfElse"],["alt","Preview",1,"object-cover","w-full","h-full",3,"src"],["alt","Imagen actual","class","object-cover w-full h-full",3,"src",4,"ngIf"],["alt","Imagen actual",1,"object-cover","w-full","h-full",3,"src"],[1,"relative","w-16","h-16","rounded-lg","overflow-hidden","bg-gray-100","border","flex","items-center","justify-center"],[1,"object-cover","w-full","h-full",3,"src","alt"],["type","button",1,"absolute","-top-2","-right-2","bg-red-500","text-white","rounded-full","w-5","h-5","flex","items-center","justify-center","text-xs","shadow",3,"click"],[1,"text-red-600","text-sm"]],template:function(r,t){r&1&&(i(0,"div",1)(1,"div",2)(2,"h2",3),s(3),o(),i(4,"button",4),_("click",function(){return t.closeModal()}),k(),i(5,"svg",5),v(6,"path",6),o()()(),T(),i(7,"form",7),_("ngSubmit",function(){return t.saveProduct()}),i(8,"div")(9,"label",8),s(10,"Nombre"),o(),i(11,"input",9),u("ngModelChange",function(e){return p(t.productForm.name,e)||(t.productForm.name=e),e}),o()(),i(12,"div")(13,"label",8),s(14,"Descripci\xF3n"),o(),i(15,"textarea",10),u("ngModelChange",function(e){return p(t.productForm.description,e)||(t.productForm.description=e),e}),o()(),i(16,"div",11)(17,"div")(18,"label",8),s(19,"Precio"),o(),i(20,"input",12),u("ngModelChange",function(e){return p(t.productForm.price,e)||(t.productForm.price=e),e}),o()(),i(21,"div")(22,"label",8),s(23,"Stock"),o(),i(24,"input",13),u("ngModelChange",function(e){return p(t.productForm.stock_quantity,e)||(t.productForm.stock_quantity=e),e}),o()()(),i(25,"div")(26,"label",8),s(27,"SKU (opcional)"),o(),i(28,"input",14),u("ngModelChange",function(e){return p(t.productForm.sku,e)||(t.productForm.sku=e),e}),o()(),i(29,"div")(30,"label",8),s(31,"Categor\xEDa"),o(),i(32,"select",15),u("ngModelChange",function(e){return p(t.productForm.category_id,e)||(t.productForm.category_id=e),e}),i(33,"option",16),s(34,"Seleccione una categor\xEDa"),o(),f(35,ne,2,2,"option",17),o()(),i(36,"div")(37,"label",8),s(38,"Imagen Principal"),o(),i(39,"div",18),f(40,se,4,2,"div",19),i(41,"input",20),_("change",function(e){return t.onFileSelected(e)}),o()()(),i(42,"div")(43,"label",8),s(44,"Im\xE1genes Secundarias"),o(),i(45,"input",21),_("change",function(e){return t.onSecondaryFilesSelected(e)}),o(),i(46,"div",22),f(47,ce,4,3,"div",23),o()(),i(48,"div",24)(49,"input",25),u("ngModelChange",function(e){return p(t.productForm.is_active,e)||(t.productForm.is_active=e),e}),o(),i(50,"label",26),s(51," Producto activo "),o()(),f(52,me,2,1,"div",27),i(53,"div",28)(54,"button",29),_("click",function(){return t.closeModal()}),s(55," Cancelar "),o(),i(56,"button",30),s(57),o()()()()),r&2&&(d(3),x(" ",t.data.mode==="create"?"Crear Producto":"Editar Producto"," "),d(8),m("ngModel",t.productForm.name),d(4),m("ngModel",t.productForm.description),d(5),m("ngModel",t.productForm.price),d(4),m("ngModel",t.productForm.stock_quantity),d(4),m("ngModel",t.productForm.sku),d(4),m("ngModel",t.productForm.category_id),d(3),c("ngForOf",t.data.categories),d(5),c("ngIf",t.imagePreview),d(7),c("ngForOf",t.secondaryImagePreviews),d(2),m("ngModel",t.productForm.is_active),d(3),c("ngIf",t.error()),d(4),c("disabled",t.loading()),d(),x(" ",t.loading()?"Guardando...":t.data.mode==="create"?"Crear":"Guardar"," "))},dependencies:[U,L,R,te,J,Y,Z,O,Q,B,X,H,G,ee,$,K,z],encapsulation:2})};export{oe as a};
