import{h as L}from"./chunk-HYBTYU64.js";import{c as j}from"./chunk-ZXTFQK7X.js";import"./chunk-TYBCTD6A.js";import{$ as g,Eb as h,Fc as D,Ga as O,Gb as o,Ia as a,Ib as l,Ic as S,Jb as k,Oa as b,Va as P,Za as p,_ as x,a as C,aa as w,b as E,ba as I,ia as y,jb as M,kb as T,lb as c,mb as r,nb as i,ob as v,rc as F,sc as V,ub as f,wb as _,xb as d,xc as $}from"./chunk-7IT3E43U.js";function q(n,t){if(n&1&&(r(0,"span",15),o(1),i()),n&2){let e=d().$implicit;a(),l(" ",e.count," ")}}function H(n,t){if(n&1){let e=f();r(0,"button",13),_("click",function(){let m=x(e).$implicit,u=d();return g(u.filterByStatus(m.value))}),o(1),p(2,q,2,1,"span",14),i()}if(n&2){let e=t.$implicit,s=d();h("border-primary-500",s.selectedStatus===e.value)("text-primary-600",s.selectedStatus===e.value)("border-transparent",s.selectedStatus!==e.value)("text-gray-500",s.selectedStatus!==e.value),a(),l(" ",e.label," "),a(),c("ngIf",e.count>0)}}function R(n,t){if(n&1&&v(0,"img",47),n&2){let e=d().$implicit;c("src",e.product.image_url,O)("alt",e.product.name)}}function B(n,t){n&1&&(r(0,"span",48),o(1," Sin imagen "),i())}function z(n,t){if(n&1){let e=f();r(0,"div",33)(1,"div",34),p(2,R,1,2,"img",35)(3,B,2,0,"span",36),i(),r(4,"div",37)(5,"h4",38),o(6),i(),r(7,"p",39),o(8),i(),r(9,"div",40)(10,"span"),o(11),i(),r(12,"span",41),o(13,"\u2022"),i(),r(14,"span"),o(15),i()()(),r(16,"div",42)(17,"p",43),o(18),i(),r(19,"div",44)(20,"button",45),_("click",function(){let m=x(e).$implicit,u=d(3);return g(u.reorderItem(m))}),o(21," Comprar de nuevo "),i(),r(22,"button",46),_("click",function(){let m=x(e).$implicit,u=d(3);return g(u.goToProduct(m.product_id))}),o(23," Ver producto "),i()()()()}if(n&2){let e=t.$implicit;a(2),c("ngIf",e.product.image_url),a(),c("ngIf",!e.product.image_url),a(3),l(" ",e.product.name," "),a(2),l(" ",e.product.description||"Sin descripci\xF3n"," "),a(3),l("Cantidad: ",e.quantity),a(4),l("Precio: $",e.price.toLocaleString()),a(3),l(" $",(e.price*e.quantity).toLocaleString()," ")}}function U(n,t){if(n&1&&(r(0,"div",27)(1,"div",28),p(2,z,24,7,"div",29),i(),r(3,"div",30)(4,"div",31)(5,"span"),o(6,"Subtotal:"),i(),r(7,"span"),o(8),i()(),r(9,"div",31)(10,"span"),o(11,"Env\xEDo:"),i(),r(12,"span"),o(13,"Gratis"),i()(),r(14,"div",32)(15,"span"),o(16,"Total:"),i(),r(17,"span"),o(18),i()()()()),n&2){let e=d().$implicit;a(2),c("ngForOf",e.items),a(6),l("$",e.total_amount.toLocaleString()),a(10),l("$",e.total_amount.toLocaleString())}}function A(n,t){if(n&1){let e=f();r(0,"div",16)(1,"div",17)(2,"div",18)(3,"div",19)(4,"div")(5,"h3",20),o(6),i(),r(7,"p",21),o(8),i()(),r(9,"span",22),o(10),i()(),r(11,"div",23)(12,"div",24)(13,"p",20),o(14),i(),r(15,"p",21),o(16),i()(),r(17,"button",25),_("click",function(){let m=x(e).$implicit,u=d();return g(u.toggleOrderDetails(m.order_id))}),o(18),i()()()(),p(19,U,19,3,"div",26),i()}if(n&2){let e=t.$implicit,s=d();a(6),l(" Pedido #",e.order_id," "),a(2),l(" ",s.formatDate(e.created_at)," "),a(),h("bg-yellow-100",e.status==="pending")("text-yellow-800",e.status==="pending")("bg-blue-100",e.status==="processing")("text-blue-800",e.status==="processing")("bg-purple-100",e.status==="shipped")("text-purple-800",e.status==="shipped")("bg-green-100",e.status==="delivered")("text-green-800",e.status==="delivered")("bg-red-100",e.status==="cancelled")("text-red-800",e.status==="cancelled"),a(),l(" ",s.getStatusLabel(e.status)," "),a(4),l(" $",e.total_amount.toLocaleString()," "),a(2),k(" ",e.items.length," ",e.items.length===1?"producto":"productos"," "),a(2),l(" ",s.expandedOrders.has(e.order_id)?"Ocultar":"Ver"," Detalles "),a(),c("ngIf",s.expandedOrders.has(e.order_id))}}function G(n,t){if(n&1){let e=f();r(0,"button",55),_("click",function(){x(e);let m=d(2);return g(m.goToShopping())}),o(1," Comenzar a Comprar "),i()}}function J(n,t){if(n&1&&(r(0,"div",11)(1,"div",49),w(),r(2,"svg",50),v(3,"path",51),i()(),I(),r(4,"h3",52),o(5),i(),r(6,"p",53),o(7),i(),p(8,G,2,0,"button",54),i()),n&2){let e=d();a(5),l(" ",e.selectedStatus==="all"?"No tienes compras a\xFAn":"No hay pedidos con este estado"," "),a(2),l(" ",e.selectedStatus==="all"?"Cuando realices tu primera compra, aparecer\xE1 aqu\xED":"Prueba con otros filtros para ver tus pedidos"," "),a(),c("ngIf",e.selectedStatus==="all")}}function K(n,t){n&1&&v(0,"div")}function Q(n,t){n&1&&(r(0,"div",56),v(1,"div",57),i())}var N=class n{constructor(t,e,s){this.http=t;this.router=e;this.toastrService=s}orders=y([]);filteredOrders=y(new Array);loading=y(!1);selectedStatus="all";expandedOrders=new Set;statusFilters=[{label:"Todos",value:"all",count:0},{label:"Pendientes",value:"pending",count:0},{label:"En Proceso",value:"processing",count:0},{label:"Enviados",value:"shipped",count:0},{label:"Entregados",value:"delivered",count:0},{label:"Cancelados",value:"cancelled",count:0}];ngOnInit(){this.loadOrders()}loadOrders(){this.loading.set(!0),this.http.get(`${S.apiUrl}/orders/my-orders`).subscribe({next:t=>{console.log("Orders loaded:",t),this.orders.set(t.orders),this.updateStatusCounts(),this.filterByStatus(this.selectedStatus),this.loading.set(!1)},error:t=>{this.loading.set(!1),this.toastrService.error("Error al cargar pedidos","Error"),console.error("Error loading orders:",t)}})}updateStatusCounts(){let t=this.orders()||[];this.statusFilters=this.statusFilters.map(e=>E(C({},e),{count:e.value==="all"?t.length:t.filter(s=>s.status===e.value).length}))}filterByStatus(t){this.selectedStatus=t;let e=this.orders();console.log("Filtering orders by status:",e),t==="all"?this.filteredOrders.set(e):this.filteredOrders.set(e?.filter(s=>s.status===t))}toggleOrderDetails(t){this.expandedOrders.has(t)?this.expandedOrders.delete(t):this.expandedOrders.add(t)}reorderItem(t){this.http.post(`${S.apiUrl}/cart/add`,{product_id:t.product_id,quantity:t.quantity}).subscribe({next:()=>{this.toastrService.success("Producto agregado al carrito","\xC9xito")},error:e=>{this.toastrService.error("Error al agregar producto al carrito","Error"),console.error("Error adding to cart:",e)}})}goToProduct(t){this.router.navigate(["/product",t])}goToShopping(){this.router.navigate(["/"])}getStatusLabel(t){return{pending:"Pendiente",processing:"En Proceso",shipped:"Enviado",delivered:"Entregado",cancelled:"Cancelado"}[t]||t}formatDate(t){return new Date(t).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}static \u0275fac=function(e){return new(e||n)(b(D),b(j),b(L))};static \u0275cmp=P({type:n,selectors:[["app-my-purchases"]],decls:16,vars:4,consts:[[1,"min-h-screen","bg-gray-50","py-8"],[1,"max-w-6xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"mb-8"],[1,"text-3xl","font-bold","text-gray-900"],[1,"text-gray-600","mt-2"],[1,"bg-white","rounded-lg","shadow-sm","mb-6"],[1,"border-b","border-gray-200"],[1,"flex","space-x-8","px-6"],["class","py-4 px-1 border-b-2 font-medium text-sm transition-colors hover:text-primary-600",3,"border-primary-500","text-primary-600","border-transparent","text-gray-500","click",4,"ngFor","ngForOf"],[1,"space-y-6"],["class","bg-white rounded-lg shadow-sm overflow-hidden",4,"ngFor","ngForOf"],[1,"text-center","py-12"],["class","flex justify-center py-12",4,"ngIf"],[1,"py-4","px-1","border-b-2","font-medium","text-sm","transition-colors","hover:text-primary-600",3,"click"],["class","ml-2 bg-gray-100 text-gray-600 py-1 px-2 rounded-full text-xs",4,"ngIf"],[1,"ml-2","bg-gray-100","text-gray-600","py-1","px-2","rounded-full","text-xs"],[1,"bg-white","rounded-lg","shadow-sm","overflow-hidden"],[1,"bg-gray-50","px-6","py-4","border-b"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between"],[1,"flex","items-center","space-x-4"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"px-3","py-1","text-sm","font-medium","rounded-full"],[1,"mt-4","sm:mt-0","flex","items-center","space-x-4"],[1,"text-right"],[1,"text-primary-600","hover:text-primary-700","font-medium","text-sm",3,"click"],["class","p-6",4,"ngIf"],[1,"p-6"],[1,"space-y-4"],["class","flex items-center p-4 bg-gray-50 rounded-lg",4,"ngFor","ngForOf"],[1,"mt-6","pt-4","border-t","border-gray-200"],[1,"flex","justify-between","text-sm","text-gray-600","mb-2"],[1,"flex","justify-between","text-lg","font-semibold","text-gray-900"],[1,"flex","items-center","p-4","bg-gray-50","rounded-lg"],[1,"w-16","h-16","bg-gray-300","rounded-lg","flex","items-center","justify-center","mr-4","flex-shrink-0"],["class","w-full h-full object-cover rounded-lg",3,"src","alt",4,"ngIf"],["class","text-gray-500 text-sm",4,"ngIf"],[1,"flex-1","min-w-0"],[1,"font-semibold","text-gray-900","truncate"],[1,"text-sm","text-gray-600","mt-1"],[1,"flex","items-center","mt-2","text-sm","text-gray-600"],[1,"mx-2"],[1,"text-right","ml-4"],[1,"font-semibold","text-gray-900"],[1,"mt-2","space-y-1"],[1,"text-primary-600","hover:text-primary-700","text-sm","font-medium","block",3,"click"],[1,"text-gray-600","hover:text-gray-700","text-sm","block",3,"click"],[1,"w-full","h-full","object-cover","rounded-lg",3,"src","alt"],[1,"text-gray-500","text-sm"],[1,"mx-auto","w-24","h-24","bg-gray-100","rounded-full","flex","items-center","justify-center","mb-6"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 11V7a4 4 0 00-8 0v4M5 9h14l-1 12H6L5 9z"],[1,"text-xl","font-semibold","text-gray-900","mb-2"],[1,"text-gray-600","mb-6"],["class","bg-primary-600 text-white px-6 py-3 rounded-lg hover:bg-primary-700 transition-colors",3,"click",4,"ngIf"],[1,"bg-primary-600","text-white","px-6","py-3","rounded-lg","hover:bg-primary-700","transition-colors",3,"click"],[1,"flex","justify-center","py-12"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-primary-600"]],template:function(e,s){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),o(4,"Mis Compras"),i(),r(5,"p",4),o(6,"Historial de todas tus compras y pedidos"),i()(),r(7,"div",5)(8,"div",6)(9,"nav",7),p(10,H,3,10,"button",8),i()()(),r(11,"div",9),p(12,A,20,28,"div",10),i(),M(13,J,9,3,"div",11)(14,K,1,0,"div"),p(15,Q,2,0,"div",12),i()()),e&2&&(a(10),c("ngForOf",s.statusFilters),a(2),c("ngForOf",s.filteredOrders()),a(),T(s.filteredOrders()&&s.filteredOrders().length===0&&!s.loading()?13:14),a(2),c("ngIf",s.loading()))},dependencies:[$,F,V],encapsulation:2})};export{N as MyPurchasesComponent};
