import{a as A}from"./chunk-DPB3RGWM.js";import{a as R}from"./chunk-M2OX4LUF.js";import{b as Q,d as L,g as z,i as H,m as G,n as U,o as J,s as K}from"./chunk-3BSRKISZ.js";import{a as W}from"./chunk-IUYS4ZSJ.js";import{a as q,c as V,d as j,g as O}from"./chunk-ZXTFQK7X.js";import"./chunk-TYBCTD6A.js";import{$ as C,Ga as M,Gb as o,Hb as _,Ia as l,Ib as g,Kb as v,Lb as x,Mb as S,Oa as h,Tb as k,Ub as T,Va as I,Za as f,_ as b,aa as E,ba as P,ia as m,lb as d,mb as r,nb as i,ob as y,rc as F,sc as N,ub as w,uc as D,wb as p,xb as u,xc as B}from"./chunk-7IT3E43U.js";function Y(a,n){if(a&1&&(r(0,"option",31),o(1),i()),a&2){let e=n.$implicit;d("value",e.category_id),l(),g(" ",e.name," ")}}function Z(a,n){if(a&1&&(r(0,"span"),o(1),i()),a&2){let e=u();l(),g(' Resultados para "',e.searchQuery(),'" ')}}function $(a,n){a&1&&(r(0,"span"),o(1," Todos los productos "),i())}function ee(a,n){a&1&&(r(0,"span"),o(1," Buscando... "),i())}function te(a,n){if(a&1&&(r(0,"p",32),o(1),i()),a&2){let e=u();l(),g(" ",e.filteredProducts().length," producto(s) encontrado(s) ")}}function re(a,n){a&1&&(r(0,"div",33),y(1,"div",34),i())}function ie(a,n){if(a&1){let e=w();r(0,"div",35)(1,"div",36),E(),r(2,"svg",37),y(3,"path",38),i()(),P(),r(4,"h3",39),o(5,"Error en la b\xFAsqueda"),i(),r(6,"p",40),o(7),i(),r(8,"button",41),p("click",function(){b(e);let c=u();return C(c.performSearch())}),o(9," Intentar de nuevo "),i()()}if(a&2){let e=u();l(7),_(e.error())}}function ne(a,n){if(a&1){let e=w();r(0,"div",44)(1,"div",45),y(2,"img",46),i(),r(3,"div",47)(4,"h3",48),o(5),i(),r(6,"p",49),o(7),i(),r(8,"p",50),o(9),i(),r(10,"div",51)(11,"span",52),o(12),k(13,"number"),i(),r(14,"button",53),p("click",function(){let c=b(e).$implicit,s=u(2);return C(s.addToCart(c))}),o(15),i()(),r(16,"div",54),o(17),i()()()}if(a&2){let e=n.$implicit;l(2),d("src",(e.images==null||e.images[0]==null?null:e.images[0].image_url)||"/placeholder-product.jpg",M)("alt",e.name),l(3),_(e.name),l(2),_(e.category==null?null:e.category.name),l(2),_(e.description),l(3),g(" ","$"+T(13,9,e.price,"1.2-2")," "),l(2),d("disabled",e.stock_quantity===0),l(),g(" ",e.stock_quantity===0?"Sin Stock":"Agregar"," "),l(2),g(" Stock: ",e.stock_quantity," unidades ")}}function oe(a,n){if(a&1&&(r(0,"div",42),f(1,ne,18,12,"div",43),i()),a&2){let e=u();l(),d("ngForOf",e.filteredProducts())}}function ae(a,n){if(a&1){let e=w();r(0,"div",35)(1,"div",55),E(),r(2,"svg",56),y(3,"path",57),i()(),P(),r(4,"h3",39),o(5,"No se encontraron productos"),i(),r(6,"p",40),o(7," Intenta con otros t\xE9rminos de b\xFAsqueda o ajusta los filtros. "),i(),r(8,"button",41),p("click",function(){b(e);let c=u();return C(c.clearFilters())}),o(9," Limpiar filtros "),i()()}}var X=class a{constructor(n,e,t,c,s){this.route=n;this.router=e;this.productsService=t;this.categoriesService=c;this.cartService=s}searchQuery=m("");products=m([]);filteredProducts=m([]);categories=m([]);loading=m(!1);error=m(null);total=m(0);page=m(1);limit=m(16);selectedCategory="";minPrice=null;maxPrice=null;sortBy="relevance";ngOnInit(){this.loadCategories(),this.route.queryParams.subscribe(n=>{let e=n.q||"";this.searchQuery.set(e),this.performSearch()})}loadCategories(){this.categoriesService.getAllCategories().subscribe({next:n=>{this.categories.set(n)},error:n=>{console.error("Error loading categories:",n)}})}performSearch(){this.loading.set(!0),this.error.set(null),this.router.navigate([],{relativeTo:this.route,queryParams:{q:this.searchQuery()},queryParamsHandling:"merge"}),(this.searchQuery().trim()?this.productsService.searchProducts(this.searchQuery()):this.productsService.getAllProducts()).subscribe({next:e=>{this.products.set(e.products),this.total.set(e.total),this.page.set(e.page),this.limit.set(e.limit),this.applyFilters(),this.loading.set(!1)},error:e=>{console.error("Error searching products:",e),this.error.set("No se pudieron cargar los productos"),this.loading.set(!1)}})}onFilterChange(){this.applyFilters()}onSortChange(){this.applyFilters()}applyFilters(){let n=[...this.products()];this.selectedCategory&&(n=n.filter(e=>e.category_id===parseInt(this.selectedCategory))),this.minPrice!==null&&(n=n.filter(e=>e.price>=this.minPrice)),this.maxPrice!==null&&(n=n.filter(e=>e.price<=this.maxPrice)),this.sortProducts(n),this.filteredProducts.set(n)}sortProducts(n){switch(this.sortBy){case"name":n.sort((e,t)=>e.name.localeCompare(t.name));break;case"price_asc":n.sort((e,t)=>e.price-t.price);break;case"price_desc":n.sort((e,t)=>t.price-e.price);break;case"newest":n.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime());break;case"relevance":default:break}}clearFilters(){this.selectedCategory="",this.minPrice=null,this.maxPrice=null,this.sortBy="relevance",this.applyFilters()}addToCart(n){n.stock_quantity!==0&&this.cartService.addToCart({product_id:n.product_id,quantity:1}).subscribe({next:e=>{console.log("Product added to cart:",e)},error:e=>{console.error("Error adding product to cart:",e)}})}static \u0275fac=function(e){return new(e||a)(h(q),h(V),h(A),h(R),h(W))};static \u0275cmp=I({type:a,selectors:[["app-search"]],decls:59,vars:14,consts:[[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-8"],[1,"mb-8"],[1,"flex","items-center","space-x-2","text-sm","text-gray-500","mb-4"],["routerLink","/",1,"hover:text-primary-600"],[1,"text-gray-900"],[1,"bg-white","rounded-lg","shadow-sm","p-6"],[1,"text-2xl","font-bold","text-gray-900","mb-4"],[1,"space-y-4"],[1,"flex","space-x-4"],[1,"flex-1"],["type","text","placeholder","Buscar productos...",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-primary-500","focus:border-transparent",3,"ngModelChange","keyup.enter","ngModel"],[1,"bg-primary-600","text-white","px-6","py-2","rounded-lg","hover:bg-primary-700","transition-colors","font-medium",3,"click"],[1,"flex","flex-wrap","gap-4","items-center"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"border","border-gray-300","rounded-md","px-3","py-2","text-sm","focus:ring-2","focus:ring-primary-500","focus:border-transparent",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","number","placeholder","0",1,"border","border-gray-300","rounded-md","px-3","py-2","text-sm","focus:ring-2","focus:ring-primary-500","focus:border-transparent","w-24",3,"ngModelChange","change","ngModel"],["type","number","placeholder","999999",1,"border","border-gray-300","rounded-md","px-3","py-2","text-sm","focus:ring-2","focus:ring-primary-500","focus:border-transparent","w-24",3,"ngModelChange","change","ngModel"],["value","relevance"],["value","name"],["value","price_asc"],["value","price_desc"],["value","newest"],[1,"mb-6"],[1,"text-xl","font-bold","text-gray-900"],[4,"ngIf"],["class","text-sm text-gray-600 mt-1",4,"ngIf"],["class","flex justify-center items-center py-12",4,"ngIf"],["class","text-center py-12",4,"ngIf"],["class","grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",4,"ngIf"],[3,"value"],[1,"text-sm","text-gray-600","mt-1"],[1,"flex","justify-center","items-center","py-12"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-primary-600"],[1,"text-center","py-12"],[1,"text-red-600","mb-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","mx-auto"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-lg","font-medium","text-gray-900","mb-2"],[1,"text-gray-600","mb-4"],[1,"bg-primary-600","text-white","px-4","py-2","rounded-md","hover:bg-primary-700","transition-colors",3,"click"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","gap-6"],["class","bg-white border border-gray-200 rounded-lg overflow-hidden hover:shadow-lg transition-shadow",4,"ngFor","ngForOf"],[1,"bg-white","border","border-gray-200","rounded-lg","overflow-hidden","hover:shadow-lg","transition-shadow"],[1,"aspect-w-1","aspect-h-1","bg-gray-200"],[1,"w-full","h-48","object-cover",3,"src","alt"],[1,"p-4"],[1,"text-lg","font-medium","text-gray-900","mb-2","line-clamp-2"],[1,"text-sm","text-gray-600","mb-2"],[1,"text-sm","text-gray-600","mb-3","line-clamp-2"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold","text-primary-600"],[1,"bg-primary-600","text-white","px-4","py-2","rounded-md","hover:bg-primary-700","disabled:bg-gray-400","disabled:cursor-not-allowed","transition-colors","text-sm","font-medium",3,"click","disabled"],[1,"mt-2","text-xs","text-gray-500"],[1,"text-gray-400","mb-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-16","h-16","mx-auto"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"]],template:function(e,t){e&1&&(r(0,"div",0)(1,"div",1)(2,"nav",2)(3,"a",3),o(4,"Inicio"),i(),r(5,"span"),o(6,"/"),i(),r(7,"span",4),o(8,"B\xFAsqueda"),i()(),r(9,"div",5)(10,"h1",6),o(11,"Buscar Productos"),i(),r(12,"div",7)(13,"div",8)(14,"div",9)(15,"input",10),p("ngModelChange",function(s){return t.searchQuery.set(s)})("keyup.enter",function(){return t.performSearch()}),i()(),r(16,"button",11),p("click",function(){return t.performSearch()}),o(17," Buscar "),i()(),r(18,"div",12)(19,"div")(20,"label",13),o(21,"Categor\xEDa"),i(),r(22,"select",14),S("ngModelChange",function(s){return x(t.selectedCategory,s)||(t.selectedCategory=s),s}),p("change",function(){return t.onFilterChange()}),r(23,"option",15),o(24,"Todas las categor\xEDas"),i(),f(25,Y,2,2,"option",16),i()(),r(26,"div")(27,"label",13),o(28,"Precio m\xEDnimo"),i(),r(29,"input",17),S("ngModelChange",function(s){return x(t.minPrice,s)||(t.minPrice=s),s}),p("change",function(){return t.onFilterChange()}),i()(),r(30,"div")(31,"label",13),o(32,"Precio m\xE1ximo"),i(),r(33,"input",18),S("ngModelChange",function(s){return x(t.maxPrice,s)||(t.maxPrice=s),s}),p("change",function(){return t.onFilterChange()}),i()(),r(34,"div")(35,"label",13),o(36,"Ordenar por"),i(),r(37,"select",14),S("ngModelChange",function(s){return x(t.sortBy,s)||(t.sortBy=s),s}),p("change",function(){return t.onSortChange()}),r(38,"option",19),o(39,"Relevancia"),i(),r(40,"option",20),o(41,"Nombre"),i(),r(42,"option",21),o(43,"Precio: Menor a Mayor"),i(),r(44,"option",22),o(45,"Precio: Mayor a Menor"),i(),r(46,"option",23),o(47,"M\xE1s Recientes"),i()()()()()()(),r(48,"div",5)(49,"div",24)(50,"h2",25),f(51,Z,2,1,"span",26)(52,$,2,0,"span",26)(53,ee,2,0,"span",26),i(),f(54,te,2,1,"p",27),i(),f(55,re,2,0,"div",28)(56,ie,10,1,"div",29)(57,oe,2,1,"div",30)(58,ae,10,0,"div",29),i()()),e&2&&(l(15),d("ngModel",t.searchQuery()),l(7),v("ngModel",t.selectedCategory),l(3),d("ngForOf",t.categories()),l(4),v("ngModel",t.minPrice),l(4),v("ngModel",t.maxPrice),l(4),v("ngModel",t.sortBy),l(14),d("ngIf",t.searchQuery()&&!t.loading()),l(),d("ngIf",!t.searchQuery()&&!t.loading()),l(),d("ngIf",t.loading()),l(),d("ngIf",!t.loading()),l(),d("ngIf",t.loading()),l(),d("ngIf",t.error()),l(),d("ngIf",!t.loading()&&!t.error()&&t.filteredProducts().length>0),l(),d("ngIf",!t.loading()&&!t.error()&&t.filteredProducts().length===0))},dependencies:[B,F,N,K,U,J,Q,H,G,L,z,O,j,D],encapsulation:2})};export{X as SearchComponent};
